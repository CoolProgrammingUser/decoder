<!DOCTYPE html>
<html>
    <head>
        <title>
            Decoder
        </title>
        <script src="https://coolprogramminguser.github.io/Standards/behavior.js"></script>
        <script>
            var words = [[]];
            var ALPHABET = ["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];
            var PUNCTUATION = [".", "?", "!", ",", "'", '"', ";", ":", "-", "(", ")"];
            window.addEventListener("load", function() {
                // sets "words" to a list of English words
                var file = new XMLHttpRequest();
                file.open("GET", "word list.txt");
                file.onreadystatechange = function () {
                    if(file.readyState === 4) {
                        if(file.status === 200 || file.status == 0) {
                            var wordList = file.responseText;  // sets words to a single string of the whole file
                            wordList = wordList.split(/\r\n|\n/);  // sets words to an array of lines of text
                            wordList.pop();  // For some reason, there's an empty item at the end of the list that I need to get rid of.
                            //////////
                            // This isn't necessary if I modify the lists.
                            var remove = ['b','c','d','e','f','g','h','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','aa','ab','ac','ah','au','av','aw','ba','bb','bc','bd','bg','bi','bk','bl','bm','bo','bp','br','bs','bt','bw','ca','cc','cb','ce','cf','cg','ch','ci','cl','cm','cn','co','cp','cr','cs','ct','cu','cv','cw','cz','da','db','dc','dd','de','df','dg','dh','di','dk','dl','dm','dp','dr','ds','dt','du','dv','dx','ea','ec','ee','ef','eg','eh','el','em','en','ep','eq','er','es','et','eu','ev','ex','ez','fa','fc','fd','fe','ff','fg','fi','fl','fm','fo','fp','fr','fs','ft','fu','fw','fx','fy','ga','gb','gc','gd','ge','gg','gi','gl','gm','gp','gr','gs','gt','ha','hb','hc','hd','hh','hk','hl','ho','hp','hq','hr','hs','ht','hu','hz','ia','ic','ie','ii','il','im','io','ip','ir','iv','ix','ja','jc','jd','je','jj','jm','jp','jr','js','ka','kb','kg','km','ko','ks','kw','ky','la','lb','lc','ld','le','lf','lg','li','ll','lm','ln','lo','lp','ls','lt','lu','mb','mc','md','mf','mg','mh','mi','mj','ml','mm','mn','mo','mp','mr','mrs','ms','mt','mu','mv','mw','mx','na','nb','nc','nd','ne','ng','nh','ni','nj','nl','nm','nn','np','nr','ns','nt','nu','nv','nw','ny','nz','ob','oc','oe','og','oh','ol','om','oo','op','os','ot','ou','oz','pb','pc','pd','pe','pf','pg','ph','pk','pl','pn','po','pp','pr','ps','pt','qc','qt','ra','rb','rc','rd','re','rf','rg','rh','ri','rl','rm','rn','ro','rp','rr','rs','rt','ru','rv','rw','rx','sa','sb','sc','sd','se','sf','sg','sh','si','sk','sl','sm','sn','sp','sq','sr','ss','st','su','sv','sw','ta','tb','tc','td','te','tf','th','ti','tm','tn','tp','tr','ts','tt','tu','tx','uc','uh','ui','uk','ul','um','un','ur','ut','uv','uw','va','vb','vc','ve','vg','vi','vp','vs','vt','wa','wb','wc','wi','wm','wn','wp','wr','ws','wt','wu','wv','ww','wx','wy','xi','xl','xp','xx','ye','yn','yr','yu','za','zu','aaa','abc','abu','acc','acm','ada','adsl','ae','af','ag','ai','ak','ala','amazoncom','amazoncouk','amd','ap','apr','ar','asn','ata','ati','aud','aus','ave','avg','avi','az'];
                            remove.forEach(function(word) {
                                wordList.splice(wordList.indexOf(word), 1);
                            });
                            var add = ['benson','zane','amps','auger','foe','ike'];
                            add.forEach(function(word) {
                                wordList.push(word);
                            });
                            wordList.sort();  // alphabetizes wordList
                            //////////
                            wordList.forEach(function(word) {
                                while (word.length > words.length) {
                                    words.push([]);
                                }
                                words[word.length-1].push(word);
                            });
                        }
                    }
                }
                file.send();
                // gives the decode button functionality
                document.getElementById("decode").addEventListener("click", function() {
                    document.getElementById("before").style.display = "none";
                    document.getElementById("during").style.display = "block";
                    setTimeout(decode, 0);
                });
                // gives the newCode button functionality
                document.getElementById("newCode").addEventListener("click", function() {
                    document.getElementById("after").style.display = "none";
                    document.getElementById("code").value = "";
                    document.getElementById("before").style.display = "block";
                    document.getElementById("solution").value = "";
                });
            });
            function decode() {
                var codeText = document.getElementById("code").value.toLowerCase().split(" ");
                var solution = document.getElementById("solution").value;
                codeText.forEach(function(text, index) {
                    text = standardize(text);
                    words[text.length-1].forEach(function(word) {
                        if (text == standardize(word)) {
                            solution += word + " ";
                        }
                    });
                    solution += "\n\n";
                });
                document.getElementById("solution").value = solution;
                document.getElementById("during").style.display = "none";
                document.getElementById("after").style.display = "block";
            }
            function standardize(characters) {
                var word = "";
                characters.forEach(function(character, index) {
                    if (character.toLowerCase() != character.toUpperCase()/*|| character=="'"*/) {  // if the character is a letter
                        word += character;
                    } else if (character == "{" && characters.indexOf("}", index) > -1) {
                        word += characters.slice(index, characters.indexOf("}",index)+1);
                    }/* else {
                        // do nothing
                        // (gets rid of non-letters)
                    } */
                });
                var uniqueLetters = {};
                word.forEach(function(letter, index, word) {
                    if (letter.toLowerCase() != letter.toUpperCase()) {
                        if (uniqueLetters[letter]) {
                            uniqueLetters[letter].push(index);
                        } else {
                            uniqueLetters[letter] = [index];
                        }
                    } else if (letter == "{") {
                        if (uniqueLetters["~"+word.slice(index+1,word.indexOf("}",index))]) {
                            uniqueLetters["~"+word.slice(index+1,word.indexOf("}",index))].push(index);
                        } else {
                            uniqueLetters["~"+word.slice(index+1,word.indexOf("}",index))] = [index];
                        }
                    }/* else {
                        // do nothing
                        // (skips the number between any {}s)
                    } */
                });
                var letters = word.split("");
                var index = 0;
                var shift = 0;
                var oldShift;
                uniqueLetters.forEach(function(numbers) {
                    numbers.forEach(function(number) {
                        if (letters[number+shift].toLowerCase() != letters[number+shift].toUpperCase()) {
                            if (index < 26) {
                                letters.splice(number+shift, 1, ALPHABET[index]);
                            } else {  // This should never happen
                                oldShift = shift;
                                shift += "{{0}".format(index-26).length;
                                letters.splice(number+oldShift, 1, "{"+(index-26)+"}");
                            }
                        } else if (letters[number+shift] == "{") {
                            oldShift = shift;
                            if (index < 26) {
                                shift -= letters.indexOf("}", number+shift) - (number+shift);  // This needs to happen first or else the splice changes things.
                                letters.splice(number+oldShift, letters.indexOf("}",number+oldShift)-(number+oldShift)+1, ALPHABET[index]);
                            } else {
                                shift += "{{0}".format(index-26).length - letters.indexOf("}",number+shift) + (number+shift);
                                letters.splice(number+oldShift, letters.indexOf("}",number+oldShift)-(number+oldShift)+1, "{"+(index-26)+"}");
                            }
                        }
                    });
                    index++;
                });
                word = "";
                letters.forEach(function(letter) {
                    word += letter;
                });
                return word;
            }
        </script>
        <style>
            #during {
                display: none;
            }/*
            #progress {
                float: left;
                width: 0%;
                height: 100%;
                background: #00e;
            }*/
            #after {
                display: none;
            }
        </style>
    </head>
    <body>
        <div id="before">
            <textarea cols="60" rows="10" placeholder="Type the code here." id="code"></textarea>
            <br>
            <br>
            <button type="button" id="decode">
                Decode
            </button>
        </div>
        <div id="during">
            <h3>
                Working...
            </h3>
            <!-- <div style="width:30em; height:1em; background:#fff; border:.1em solid black;">
            <div id="progress">
            </div>
            </div> -->
            <progress id="progress"></progress>
        </div>
        <div id="after">
            <textarea cols="60" rows="10" id="solution" readonly></textarea>
            <p id="solutionNumber"></p>
            <button type="button" id="newCode">
                Try a new<br>
                code
            </button>
        </div>
    </body>
</html>
